sudo: false

language: python

python:
 - "3.5"

jobs:
  include:
  - stage: tests
    env: ENGINE
    script:
        - nosetests --with-doctest -xvs -a'!slow' openquake.engine
        - mkdir ~/oqdata; nosetests --with-doctest -xvs -a'!slow' openquake.server
        - bin/oq webui migrate
        - cat /tmp/webui*
    after_success:
        - pip install sphinx==1.3.6 && cd doc/sphinx && make html
  - stage: tests
    env: HAZARDLIB
    script:
        - nosetests --with-doctest -xvs -a'!slow' openquake.hazardlib
  - stage: tests
    env: RISKLIB
    script:
        - nosetests --with-doctest -xvs -a'!slow' openquake.risklib
  - stage: tests
    env: COMMON
    script:
        - nosetests --with-doctest -xvs -a'!slow' openquake.commonlib
        - nosetests --with-doctest -xvs -a'!slow' openquake.commands
  - stage: tests
    env: HMTK
    script:
        - nosetests --with-doctest -xvs -a'!slow' openquake.hmtk
  - stage: demos
    env: DEMOS
    script: 
        - bin/run-demos.sh

install:
  - pip -q install -r requirements-py35-linux64.txt
  - pip -q install -e .

before_script:
  - python -c'import platform; print(platform.platform())'

after_script:
  - bin/oq reset --yes
