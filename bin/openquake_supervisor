#! /usr/bin/env python

import signal
import sys

from openquake import supervise

try:
    import setproctitle
except ImportError:
    def set_proc_title(title):
        pass
else:
    def set_proc_title(title):
        setproctitle.setproctitle(title)

if __name__ == '__main__':
    job_id, pid = map(int, sys.argv[1:])

    # Set the name of this process (as reported by /bin/ps)
    set_proc_title('openquake supervisor for job_id=%s job_pid=%s'
                   % (job_id, pid))

    # This supervisor will be spawned by bin/openquake and interrupting
    # bin/openquake with Ctrl-C from the shell will propagate the signal to
    # this supervisor, killing it.
    # To avoid premature death of the supervisor we ignore the SIGINT signal.
    def handler(signum, frame):
        pass

    signal.signal(signal.SIGINT, handler)

    supervise(pid, job_id)
