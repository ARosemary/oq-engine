#!/usr/bin/env python

import logging
from openquake.commonlib import sap, nrml, __version__, readinput
from openquake.commonlib.calc import run_scenario

################################# NRML ######################################

def check(nrmlfile, pprint):
    """
    Check the validity of NRML files. Optionally, displays them in indented
    format.
    """
    node = nrml.read(nrmlfile)
    if pprint:
        print node.to_str()

check_parser = sap.Parser(check)
check_parser.arg('nrmlfile', 'file in NRML format')
check_parser.flg('pprint', 'display in indented format')


############################ calculation ####################################

def run(job_ini):
    """
    Run a calculation.
    """
    with open(job_ini) as f:
        oqparam = readinput.get_oqparam(job_ini, hazard_output_id=1)
        run_scenario(oqparam)
        

run_parser = sap.Parser(run)
run_parser.arg('job_ini', 'calculation configuration')

if __name__ == '__main__':
    parser = sap.compose([check_parser, run_parser], version=__version__)
    parser.callfunc()
