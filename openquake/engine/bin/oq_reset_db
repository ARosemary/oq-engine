#!/bin/bash
echo ''
echo "!! ${bold}This script is going to remove the OpenQuake Engine data${normal}"
echo '!!'
echo -e "!! \t*  Make sure no calculations are running"
echo -e "!! \t*  Make sure Celery is stopped"
echo -e "!! \t*  The OpenQuake Engine datastores located in /home/[user]/oqdata will be removed"
echo -e "!! \t*  The OpenQuake Engine database will be dropped"
echo -e "!! \t   All the old data contained will be lost"
if [ -z $skipnew ]; then
    echo -e "!! \t*  A new OpenQuake Engine database will be created"
fi
echo '!!'
if [ $force ]; then
    for i in {5..1}; do
        echo -ne "\r!! Press CTRL-C to cancel the operation within ${i} seconds"
        sleep 1
    done
    answer="y"
else
    echo -n "!! Do you want to proceed? (y/n)"
    read -n 1 -s answer
fi
echo ''
echo ''

if [[ "$answer" == "y" ]]; then
    sudo -u openquake rm ~openquake/db.sqlite3
    echo " * Database dropped"
    sudo find /home -maxdepth 2 -type d -name "oqdata" -exec rm -Rf '{}' \;
    echo " * Datastores cleaned"
    if [ -z $skipnew ]; then
        sudo -u openquake $oq_create_db
    fi
    echo ''
    echo "!!"
    echo "!! DONE"
    echo "!!"
    echo ''
fi
